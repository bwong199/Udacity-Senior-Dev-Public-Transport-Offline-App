$(document).ready(function(){if(navigator.onLine){console.log("online"),indexedDB.deleteDatabase("trainInfo");var e=indexedDB.open("trainInfo",1);e.onupgradeneeded=function(e){var t=e.target.result;if(!t.objectStoreNames.contains("departure_stations")){var a=t.createObjectStore("departure_stations",{keyPath:"id",autoIncrement:!0});a.createIndex("id","id",{unique:!1})}},e.onsuccess=function(e){console.log("Success: Opened Database..."),db=e.target.result},e.onerror=function(e){console.log("Error: Could Not Open Database...")};var t="https://transit.land/api/v1/stops",a=setTimeout(function(){alert("failed to get transit data")},4e3);$.ajax({url:t,dataType:"json",jsonp:"callback",success:function(e){var t=db.transaction(["departure_stations"],"readwrite"),n=t.objectStore("departure_stations"),r=e.stops;for(var o in r){var i=r[o].name,s=r[o].onestop_id,p={id:s,name:i};n.add(p);$("#departureOption").append('<option value="'+s+'">'+i+"</option>")}clearTimeout(a)}})}else{console.log("offline");var e=indexedDB.open("trainInfo",1);e.onsuccess=function(e){console.log("Success: Opened Database..."),db=e.target.result;var t=db.transaction(["departure_stations"],"readonly"),a=t.objectStore("departure_stations"),n=a.index("id");n.openCursor().onsuccess=function(e){var t=e.target.result;t&&($("#departureOption").append('<option value="'+t.value.id+'">'+t.value.name+"</option>"),t["continue"]())}}}navigator.onLine?$("#departureBtn").click(function(e){$("#departure").text(" "),e.preventDefault(),$("p").empty();var t=$("#departureOption option:selected").val(),n="https://transit.land/api/v1/schedule_stop_pairs?origin_onestop_id="+t;$.ajax({url:n,dataType:"json",jsonp:"callback",success:function(e){var t=[],n=[],r=[],o=e.schedule_stop_pairs;for(var i in o){var s=o[i].destination_onestop_id,p=(o[i].destination_departure_time,o[i].destination_arrival_time,o[i].origin_departure_time,o[i].origin_arrival_time,o[i].trip_headsign);n.push(p),n.push(s),t.push(n)}n=jQuery.unique(n),r=jQuery.unique(r),t=jQuery.unique(t);for(x in t)$("#arrivalOption").append('<option value="'+t[x][1]+'">'+t[x][0]+"</option>");clearTimeout(a)}})}):console.log("offline. Cannot press button"),$("#arrivalBtn").click(function(e){$("p").empty(),e.preventDefault();var t=$("#arrivalOption option:selected").val(),n="https://transit.land/api/v1/schedule_stop_pairs?origin_onestop_id="+t;$.ajax({url:n,dataType:"json",jsonp:"callback",success:function(e){var t=e.schedule_stop_pairs,n=[];for(var r in t){var o=t[r].origin_departure_time,i=(t[r].origin_arrival_time,t[r].destination_departure_time,t[r].destination_arrival_time);$("#departure").append(o+"<br>"),$("#arrival").append(i+"<br>");var s=[];s.push(o),s.push(i),n.push(s)}for(x in n){var p=String(n[x]).substring(12,14)-String(n[x]).substring(3,5);p<0&&(p+=60),$("#duration").append(p+" mins<br>")}clearTimeout(a)}})})});